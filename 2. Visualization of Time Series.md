# 1.2A 시계열 시각화 (Time Series Graphics)
### 주기성(Cycles)과 계절성(Seasonals)
- 차이
  - 계절성을 가진 패턴은 길이가 고정적이다. 즉, 같은 시기에 같은 분기마다 반복되는 패턴을 보인다. 
  -  주기성을 가진 패턴은 길이가 고정적이지 않다. 
  - 평균적으로 cylcle 주기의 길이가 계절성을 가진 패턴보다 길다.
  - 주기성을 가진 패턴의 변동폭이 계절성을 가진 패턴의 변동폭보다 크다.
  - Seasonal data에서는 peak가 나타나는 시기가 어느정도 예측 가능하지만, Cyclic data에서는 어렵다.
- Seasonal plots
  - Mutiple seasonal plots
    - <img src= "https://github.com/safeai-snu/Time-series/assets/89092141/fd94b225-ed1f-4917-8a60-a6a723eb9904" width="500" height="400">
    - 각 season의 plot을 겹쳐놓은 그래프이다.
    - 한 season에서의 경향성을 파악할 수 있다. 
  - Seasonal subseries plots
    - <img src= "https://github.com/safeai-snu/Time-series/assets/89092141/d908f849-4280-4e79-90a2-440121038f28" width="800" height="200">
    - 각 시즌 별 데이터를 분리하여 살펴보는 그래프이다. 
  - Scatterplots
    - <img src= "https://github.com/safeai-snu/Time-series/assets/89092141/4961f1f7-b920-4c2b-8a8c-88ce1b5f51de" width="500" height="500"> <br/>출처:https://otexts.com/fpp3/scatterplots.html
    - 위와 같은 Scatter plot matrix는 여러 변수 간의 관계를 탐색하는데에 사용된다. 
    - Scatterplot을 통해 변수들 간의 Corretlation을 확인할 수 있다.
    - Correlation : $r = \frac{\sum (x_t - \bar{x})(y_t - \bar{y})}{\sqrt{\sum (x_t - \bar{x})^2} \sqrt{\sum (y_t - \bar{y})^2}}$ 
  - Lag plots
    - 시점 간의 관계를 파악할 수 있다.
    - Lag : 현재 시점 값에 대한 이전 시점 값의 차이
    - <img src="https://github.com/safeai-snu/Time-series/assets/89092141/264fcb6c-dcfe-4202-9afe-0a3a4651221b" width="500" height="500">
    - Lag2, Lag6에서는 반비례하는 패턴, Lag4와 Lag8에서는 비례하는 패턴이 나타난다.
    - Lag plot을 통해 계절성(Seasonality)을 파악할 수 있다. 
# 1.2B 자기상관관계와 화이트 노이즈 (AutoCorrelation and White Noise)
### Autocorrelation function (ACF)
- Auto correlation function(ACF)
  - $\gamma_l = \text{Cov}(r_t, r_{t-l}) : \text{lag-}l \, r_t\text{의 자기공분산(autocovariance)} $
  - $\rho_l = \frac{\text{Cov}(r_t, r_{t-l})}{\sqrt{\text{Var}(r_t) \, \text{Var}(r_{t-l})}} = \frac{\gamma_l}{\gamma_0} : \text{lag-}l \, r_t \text{의 자기상관(autocorrelation)}$
  - $\gamma_0 = \text{Var}(r_t), \quad \gamma_l = \gamma_{-l} \quad \text{and} \quad |\gamma_l| \leq \gamma_0 \quad \text{for all } l; \\
\rho_0 = 1, \quad \rho_l = \rho_{-l} \quad \text{and} \quad -1 \leq \rho_l \leq 1 \quad \text{for all } l
$이 성립한다. 

  - 약한 정상성 가정(weak stationarity assumption)하에서 $\gamma_l$ 과 $\rho_l$은 시간 t와 독립이다.


- Sample Autocorreltion function(SACF)
  - 정상성(stationarity)가정 필요 
  - ${r_t}_{t=1,\ldots,T}$에 대해 lag- 𝒍 sample autocorrelation $\hat{\rho}_l = \frac{\sum_{t=l+1}^T (r_t - \bar{r}) (r_{t-l}   -\bar{r})}{\sum_{t=1}^T (r_t - \bar{r})^2}, \quad \bar{r} = \frac{1}{T} \sum_{t=1}^T r_t$(수식 왜 안되는지 모르겠어요 ㅠㅠㅠ)
  - 백색 소음(white noise)에서는 모든 ACF가 0이다. 실제 상황에서는, 모든 SACF가 0에 가까우면 series를 백색소음으로 정의한다.
### Trend and seasonality in ACF plots
- 추세가 있는 데이터의 경우, 작은 lag에 대한 자기상관계수(autocorrelation)는 크고 양수일 가능성이 높다.
- 계절성이 있는 데이터의 경우, 자기상관계수(autocorrelation)는 계절 주기의 배수에서(즉, 계절 주기의 배수에 해당하는 lag에서) 더 크게 나타날 것이다.
- 추세와 계절성이 동시에 있는 경우, 이러한 효과들의 조합을 관찰할 수 있다.
### Testing ACF
- $t \text{ ratio}$ = $\frac{\hat{\rho}_l}{\sqrt{\frac{1 + 2\sum_{i=1}^{l-1} (\hat{\rho}_i)^2}{T}}}$ (이것도 수식 왜 안되는지 모르겠어요..)
- $|\text{t ratio}| > Z_{\frac{\alpha}{2}}$이면 귀무가설 $H_0$ 기각 ($Z_{\frac{\alpha}{2}}$가 $N(0,1)$에서 $(1-\frac{\alpha}{2})$%에 해당하는 값이다.)
- Portmanteau test
 - 귀무가설 ($H₀$): $\rho_1 = \cdots = \rho_m = 0 $
 - 대립가설 ($H₁$): $\rho_i \neq 0 \ \text{for some} \ i \in \{1, \cdots, m\}$  for some $i \in \{1, \cdots, m\} \$
  - 귀무가설이 기각되는 것은 Autocorrelation이 있음을 의미한다.
   1. **Box and Pierce (1970):**
   - Portmanteau 검정 통계량: $\(Q(m) = T \ sum_{l=1}^m(\hat{\rho}_l)^2 \)$
   - 검정 통계량의 근사치: $\(Q(m) \approx \chi^2(m)\)$ ,여기서 $\(\chi^2(m)\)$는 자유도 $\(m\)$의 카이제곱 분포이다.
   2. **Ljung and Box (1978):**
   - 수정된 Portmanteau 검정 통계량: $Q^*(m) = \frac{T(T+2)}{T-l}$ $\sum_{l=1}^m\$ $(\hat{\rho}_l)^2 \approx \chi^2(m)$
   - 검정 통계량의 근사치: $Q^*(m) \approx \chi^2(m)$ 
   3. **귀무가설 기각 조건:**
   - $H_0$ 기각 조건: $Q(m) > \chi^2_{\alpha}$, 여기서 $\chi^2_{\alpha}$는 자유도 $m$의 카이제곱 분포의 상위 $\alpha\%$ 값을 나타내거나,  p-value가 $\alpha$보다 작거나 같으면 $H_0$을 기각한다.
  4. $m \approx \ln(T)$이 더 나은 검정력을 제공한다.



